{% extends 'base.html' %}

{% block title %}Inbox - Minibini{% endblock %}

{% block content %}
<h2>Inbox</h2>

<p><strong>Fetched from server:</strong> {{ stats.new }} new, {{ stats.existing }} existing</p>
<p><strong>Displaying:</strong> {{ displayed_count }} of {{ total_count }} total emails (limit: {{ display_limit }})</p>

{% if stats.errors %}
<p><strong>Errors:</strong></p>
<ul>
    {% for error in stats.errors %}
        <li>{{ error }}</li>
    {% endfor %}
</ul>
{% endif %}

{% if emails %}
    <table border="1">
        <tr>
            <th>Date</th>
            <th>From</th>
            <th>Subject</th>
            <th>Job</th>
            <th>Attachments</th>
        </tr>
        {% for email in emails %}
        <tr>
            <td>{{ email.date_sent|date:"Y-m-d H:i" }}</td>
            <td>{{ email.from_email }}</td>
            <td><a href="{% url 'core:email_detail' email.email_record.email_record_id %}">{{ email.subject|truncatewords:10 }}</a></td>
            <td>
                {% if email.email_record.job %}
                    <a href="{% url 'jobs:detail' email.email_record.job.job_id %}">{{ email.email_record.job.job_number }}</a>
                {% else %}
                    <em>None</em>
                {% endif %}
            </td>
            <td>{% if email.has_attachments %}Yes{% else %}No{% endif %}</td>
        </tr>
        {% endfor %}
    </table>
{% else %}
    <p>No emails found.</p>
{% endif %}
{% endblock %}
