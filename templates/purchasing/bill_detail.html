{% extends 'base.html' %}

{% block title %}Bill {{ bill.bill_id }} - Minibini{% endblock %}

{% block content %}
<h2>Bill: {{ bill.bill_id }} - <strong>{{ bill.get_status_display }}</strong></h2>

<table border="1">
    <tr>
        <th>Field</th>
        <th>Value</th>
    </tr>
    <tr>
        <td>Status</td>
        <td>{{ bill.get_status_display }}</td>
    </tr>
    <tr>
        <td>Purchase Order</td>
        <td>
            {% if bill.purchase_order %}
                <a href="{% url 'purchasing:purchase_order_detail' bill.purchase_order.po_id %}">{{ bill.purchase_order }}</a>
            {% else %}
                No purchase order assigned
            {% endif %}
        </td>
    </tr>
    <tr>
        <td>Associated Job</td>
        <td>
            {% if bill.purchase_order and bill.purchase_order.job %}
                <a href="{% url 'jobs:detail' bill.purchase_order.job.pk %}">{{ bill.purchase_order.job }}</a>
            {% else %}
                No job assigned
            {% endif %}
        </td>
    </tr>
    <tr>
        <td>Contact</td>
        <td>{{ bill.contact }}</td>
    </tr>
    <tr>
        <td>Vendor Invoice Number</td>
        <td>{{ bill.vendor_invoice_number }}</td>
    </tr>
    <tr>
        <td>Created Date</td>
        <td>{{ bill.created_date|date:"Y-m-d H:i" }}</td>
    </tr>
    <tr>
        <td>Due Date</td>
        <td>
            {% if bill.due_date %}
                {{ bill.due_date|date:"Y-m-d" }}
            {% else %}
                Not specified
            {% endif %}
        </td>
    </tr>
    {% if bill.received_date %}
    <tr>
        <td>Received Date</td>
        <td>{{ bill.received_date|date:"Y-m-d H:i" }}</td>
    </tr>
    {% endif %}
    {% if bill.paid_date %}
    <tr>
        <td>Paid Date</td>
        <td>{{ bill.paid_date|date:"Y-m-d H:i" }}</td>
    </tr>
    {% endif %}
    {% if bill.cancelled_date %}
    <tr>
        <td>Cancelled Date</td>
        <td>{{ bill.cancelled_date|date:"Y-m-d H:i" }}</td>
    </tr>
    {% endif %}
</table>

<h3>Line Items</h3>
{% if bill.status == 'draft' %}
    <p><a href="{% url 'purchasing:bill_add_line_item' bill.bill_id %}">Add Line Item</a></p>
{% endif %}
{% include 'includes/_line_items_table.html' with total_label="Total Bill Amount" %}

<p><a href="{% url 'purchasing:bill_list' %}">Back to Bills List</a></p>
{% endblock %}