{% extends 'base.html' %}

{% block title %}Job {{ job.job_number }} - Minibini{% endblock %}

{% block content %}
<h2>Job {{ job.job_number }}</h2>

<table border="1">
    <tr>
        <th>Field</th>
        <th>Value</th>
    </tr>
    <tr>
        <td>Job ID</td>
        <td>{{ job.job_id }}</td>
    </tr>
    <tr>
        <td>Job Number</td>
        <td>{{ job.job_number }}</td>
    </tr>
    <tr>
        <td>Status</td>
        <td>{{ job.get_status_display }}</td>
    </tr>
    <tr>
        <td>Created Date</td>
        <td>{{ job.created_date }}</td>
    </tr>
    <tr>
        <td>Completion Date</td>
        <td>{{ job.completion_date|default:"Not completed" }}</td>
    </tr>
    <tr>
        <td>Contact</td>
        <td>{{ job.contact }}</td>
    </tr>
    <tr>
        <td>Description</td>
        <td>{{ job.description|default:"No description" }}</td>
    </tr>
</table>

<h3>Associated Estimates</h3>
{% if estimates %}
    <table border="1" style="border-collapse: collapse; width: 100%; margin-top: 10px;">
        <thead>
            <tr>
                <th>Estimate Number</th>
                <th>Revision</th>
                <th>Status</th>
                <th>Created Date</th>
                <th>Superseded Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for estimate in estimates %}
            <tr>
                <td>{{ estimate.estimate_number }}</td>
                <td>{{ estimate.revision_number }}</td>
                <td>{{ estimate.get_status_display }}</td>
                <td>{{ estimate.created_date|date:"M d, Y" }}</td>
                <td>{{ estimate.superseded_date|date:"M d, Y"|default:"—" }}</td>
                <td>
                    <a href="{% url 'jobs:estimate_detail' estimate.pk %}">View Details</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No estimates found for this job.</p>
{% endif %}

<h3>Associated Purchase Orders</h3>
{% if purchase_orders %}
    <table border="1" style="border-collapse: collapse; width: 100%; margin-top: 10px;">
        <thead>
            <tr>
                <th>PO Number</th>
                <th>PO ID</th>
                <th>Price List Item ID</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for purchase_order in purchase_orders %}
            <tr>
                <td>{{ purchase_order.po_number }}</td>
                <td>{{ purchase_order.po_id }}</td>
                <td>{{ purchase_order.price_list_item|default:"—" }}</td>
                <td>
                    <a href="{% url 'purchasing:purchase_order_detail' purchase_order.po_id %}">View Details</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No purchase orders found for this job.</p>
{% endif %}

<p><a href="{% url 'jobs:list' %}">Back to Jobs List</a></p>
{% endblock %}