{% extends 'base.html' %}

{% block title %}Tasks - Minibini{% endblock %}

{% block content %}
<h2>All Tasks</h2>

{% if tasks %}
    <table border="1">
        <tr>
            <th>Name</th>
            <th>Job</th>
            <th>Est. Qty</th>
            <th>Units</th>
            <th>Rate</th>
            <th>Assignee</th>
            <th>Work Order</th>
        </tr>
        {% for task in tasks %}
        <tr>
            <td><a href="{% url 'jobs:task_detail' task.pk %}">{{ task.name }}</a></td>
            <td>
                {% if task.work_order.job %}
                    <a href="{% url 'jobs:detail' task.work_order.job.pk %}">{{ task.work_order.job.job_number }}{% if task.work_order.job.name %}: {{ task.work_order.job.name }}{% endif %}</a>
                {% else %}
                    —
                {% endif %}
            </td>
            <td>{{ task.est_qty|floatformat:2|default:"—" }}</td>
            <td>{{ task.units|default:"—" }}</td>
            <td>
                {% if task.rate %}
                    ${{ task.rate|floatformat:2 }}
                {% else %}
                    —
                {% endif %}
            </td>
            <td>
                {% if task.assignee %}
                    <a href="{% url 'core:user_detail' task.assignee.pk %}">{{ task.assignee.username }}</a>
                {% else %}
                    Unassigned
                {% endif %}
            </td>
            <td><a href="{% url 'jobs:work_order_detail' task.work_order.pk %}">WO-{{ task.work_order.work_order_id }}</a></td>
        </tr>
        {% endfor %}
    </table>
{% else %}
    <p>No incomplete tasks with work orders found.</p>
{% endif %}
{% endblock %}