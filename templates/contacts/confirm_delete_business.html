{% extends 'base.html' %}

{% block title %}Delete Business - Minibini{% endblock %}

{% block content %}
<h2>Delete Business</h2>

<div style="background-color: #fff3cd; padding: 15px; margin-bottom: 20px; border-radius: 4px; border-left: 4px solid #ffc107;">
    <strong>Deleting Business:</strong> {{ business.business_name }}
    <br><strong>Reference Code:</strong> {{ business.our_reference_code }}
</div>

{% if messages %}
    {% for message in messages %}
        <div style="padding: 10px; margin-bottom: 10px; background-color: {% if message.tags == 'error' %}#ffebee; color: #c62828;{% else %}#e8f5e8; color: #2e7d32;{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<div style="margin-bottom: 20px;">
    <p>This business has <strong>{{ contact_count }}</strong> associated contact(s).</p>

    {% if contact_count > 0 %}
    <p>What would you like to do with these contacts?</p>
    {% endif %}
</div>

<form method="post" action="{% url 'contacts:delete_business' business.business_id %}" style="max-width: 600px;">
    {% csrf_token %}

    {% if contact_count > 0 %}
    <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 10px; font-weight: bold; font-size: 1.1em;">
            Contact Action *
        </label>

        <div style="border: 2px solid #dee2e6; border-radius: 4px; padding: 15px; margin-bottom: 15px;">
            <label style="display: flex; align-items: start; cursor: pointer; padding: 10px; border-radius: 4px; transition: background-color 0.2s;">
                <input
                    type="radio"
                    name="contact_action"
                    value="unlink"
                    required
                    style="margin-top: 3px; margin-right: 10px; width: 18px; height: 18px; cursor: pointer;"
                >
                <div>
                    <strong style="display: block; margin-bottom: 5px;">Unlink Contacts</strong>
                    <span style="color: #6c757d; font-size: 0.9em;">
                        Keep the contacts but remove their association with this business.
                        Contacts will become independent (no business assigned).
                    </span>
                </div>
            </label>
        </div>

        <div style="border: 2px solid #dc3545; border-radius: 4px; padding: 15px;">
            <label style="display: flex; align-items: start; cursor: pointer; padding: 10px; border-radius: 4px; transition: background-color 0.2s;">
                <input
                    type="radio"
                    name="contact_action"
                    value="delete"
                    required
                    style="margin-top: 3px; margin-right: 10px; width: 18px; height: 18px; cursor: pointer;"
                >
                <div>
                    <strong style="display: block; margin-bottom: 5px; color: #dc3545;">Delete All Contacts</strong>
                    <span style="color: #6c757d; font-size: 0.9em;">
                        Permanently delete all contacts associated with this business.
                        This action cannot be undone.
                    </span>
                </div>
            </label>
        </div>
    </div>

    <div style="margin-bottom: 20px; padding: 15px; background-color: #e3f2fd; border-radius: 4px;">
        <h4 style="margin-top: 0; color: #1976d2;">Associated Contacts:</h4>
        <ul style="margin: 0; padding-left: 20px;">
            {% for contact in contacts %}
                <li>{{ contact.name }} - {{ contact.email }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div style="margin-top: 30px; padding: 15px; background-color: #ffebee; border-radius: 4px; border-left: 4px solid #dc3545;">
        <strong style="color: #c62828;">âš  Warning:</strong> Deleting this business cannot be undone.
    </div>

    <div style="margin-top: 30px;">
        <button
            type="submit"
            style="background-color: #dc3545; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; margin-right: 10px;"
        >
            Delete Business
        </button>
        <a
            href="{% url 'contacts:business_detail' business.business_id %}"
            style="background-color: #6c757d; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px; display: inline-block;"
        >
            Cancel
        </a>
    </div>
</form>

<script>
// Highlight selected radio option
document.querySelectorAll('input[name="contact_action"]').forEach(function(radio) {
    radio.addEventListener('change', function() {
        document.querySelectorAll('input[name="contact_action"]').forEach(function(r) {
            r.parentElement.style.backgroundColor = '';
        });
        if (this.checked) {
            this.parentElement.style.backgroundColor = '#f8f9fa';
        }
    });
});
</script>

{% endblock %}
