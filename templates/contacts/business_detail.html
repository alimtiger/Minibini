{% extends 'base.html' %}

{% block title %}Business {{ business.business_name }} - Minibini{% endblock %}

{% block content %}
<h2>Business: {{ business.business_name }}</h2>
<div style="margin-bottom: 20px;">
    <a href="{% url 'contacts:edit_business' business.business_id %}" style="display: inline-block; background-color: #ffc107; color: black; padding: 10px 20px; text-decoration: none; border-radius: 4px; margin-right: 10px;">Edit Business</a>
    <button onclick="confirmDeleteBusiness()" style="background-color: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">Delete Business</button>
</div>

<table border="1">
    <tr>
        <th>Field</th>
        <th>Value</th>
    </tr>
    <tr>
        <td>Business Name</td>
        <td>{{ business.business_name }}</td>
    </tr>
    <tr>
        <td>Reference Code</td>
        <td>{{ business.our_reference_code|default:"No reference code" }}</td>
    </tr>
    <tr>
        <td>Business Phone</td>
        <td>{{ business.business_phone|default:"No phone number" }}</td>
    </tr>
    <tr>
        <td>Address</td>
        <td>{{ business.business_address|default:"No address" }}</td>
    </tr>
    <tr>
        <td>Tax Exemption Number</td>
        <td>{{ business.tax_exemption_number|default:"No tax exemption number" }}</td>
    </tr>
    <tr>
        <td>Website</td>
        <td>{% if business.website %}<a href="{{ business.website }}" target="_blank">{{ business.website }}</a>{% else %}No website{% endif %}</td>
    </tr>
    <tr>
        <td>Payment Terms</td>
        <td>{{ business.terms|default:"No payment terms" }}</td>
    </tr>
    <tr>
        <td>Default Contact</td>
        <td>
            {% if business.default_contact %}
                <a href="{% url 'contacts:contact_detail' business.default_contact.contact_id %}">{{ business.default_contact }}</a>
            {% else %}
                No default contact
            {% endif %}
        </td>
    </tr>
</table>

<h3>Associated Contacts</h3>
<a href="{% url 'contacts:add_business_contact' business.business_id %}" style="display: inline-block; background-color: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; margin-bottom: 20px;">Add Contact</a>
{% if contacts %}
    <table border="1" style="border-collapse: collapse; width: 100%; margin-top: 10px;">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Address</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for contact in contacts %}
            <tr{% if business.default_contact and contact.contact_id == business.default_contact.contact_id %} style="background-color: #e3f2fd;"{% endif %}>
                <td>
                    {{ contact }}
                    {% if business.default_contact and contact.contact_id == business.default_contact.contact_id %}
                        <span style="color: #1976d2; font-weight: bold; margin-left: 5px;">[DEFAULT]</span>
                    {% endif %}
                </td>
                <td>{{ contact.email|default:"No email" }}</td>
                <td>{{ contact.mobile_number|default:contact.work_number|default:contact.home_number|default:"No phone" }}</td>
                <td>{{ contact.address|default:"No address" }}</td>
                <td>
                    <a href="{% url 'contacts:contact_detail' contact.pk %}">View Details</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No contacts found for this business.</p>
{% endif %}

<p><a href="{% url 'contacts:business_list' %}">Back to Businesses List</a></p>

<!-- Hidden delete form -->
<form id="deleteBusinessForm" method="post" action="{% url 'contacts:delete_business' business.business_id %}" style="display: none;">
    {% csrf_token %}
</form>

<script>
function confirmDeleteBusiness() {
    if (confirm('Are you sure you want to delete "{{ business.business_name }}"? You will be able to choose what happens to the associated contacts in the next step.')) {
        document.getElementById('deleteBusinessForm').submit();
    }
}
</script>
{% endblock %}