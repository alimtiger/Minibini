{% extends 'base.html' %}

{% block title %}Add Contact - Minibini{% endblock %}

{% block content %}
<h2>Add Contact</h2>

{% if messages %}
    {% for message in messages %}
        <div style="padding: 10px; margin-bottom: 10px; background-color: {% if message.tags == 'error' %}#ffebee; color: #c62828;{% else %}#e8f5e8; color: #2e7d32;{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<form method="post" style="max-width: 400px;">
    {% csrf_token %}
    <div style="margin-bottom: 15px;">
        <label for="first_name" style="display: block; margin-bottom: 5px; font-weight: bold;">First Name *</label>
        <input type="text" id="first_name" name="first_name" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
    </div>

    <div style="margin-bottom: 15px;">
        <label for="middle_initial" style="display: block; margin-bottom: 5px; font-weight: bold;">Middle Initial</label>
        <input type="text" id="middle_initial" name="middle_initial" maxlength="10" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
    </div>

    <div style="margin-bottom: 15px;">
        <label for="last_name" style="display: block; margin-bottom: 5px; font-weight: bold;">Last Name *</label>
        <input type="text" id="last_name" name="last_name" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
    </div>

    <div style="margin-bottom: 15px;">
        <label for="email" style="display: block; margin-bottom: 5px; font-weight: bold;">Email Address *</label>
        <input type="email" id="email" name="email" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
    </div>

    <fieldset style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 4px;">
        <legend style="font-weight: bold; padding: 0 10px;">Phone Numbers * (at least one required)</legend>

        <div style="margin-bottom: 15px;">
            <label for="work_number" style="display: block; margin-bottom: 5px; font-weight: bold;">Work Phone</label>
            <input type="tel" id="work_number" name="work_number" class="phone-field" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
        </div>

        <div style="margin-bottom: 15px;">
            <label for="mobile_number" style="display: block; margin-bottom: 5px; font-weight: bold;">Mobile Phone</label>
            <input type="tel" id="mobile_number" name="mobile_number" class="phone-field" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
        </div>

        <div style="margin-bottom: 0;">
            <label for="home_number" style="display: block; margin-bottom: 5px; font-weight: bold;">Home Phone</label>
            <input type="tel" id="home_number" name="home_number" class="phone-field" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
        </div>
    </fieldset>

    <div style="margin-bottom: 15px;">
        <label for="address" style="display: block; margin-bottom: 5px; font-weight: bold;">Street Address</label>
        <input type="text" id="address" name="address" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
    </div>

    <div style="margin-bottom: 15px;">
        <label for="city" style="display: block; margin-bottom: 5px; font-weight: bold;">City</label>
        <input type="text" id="city" name="city" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
    </div>

    <div style="margin-bottom: 20px;">
        <label for="postal_code" style="display: block; margin-bottom: 5px; font-weight: bold;">Postal Code</label>
        <input type="text" id="postal_code" name="postal_code" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
    </div>

    <!-- Business Information Section -->
    <fieldset style="border: 2px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 4px;">
        <legend style="font-weight: bold; font-size: 16px; padding: 0 10px;">Business Information (Optional)</legend>

        <div style="margin-bottom: 15px;">
            <label for="business_name" style="display: block; margin-bottom: 5px; font-weight: bold;">Business Name</label>
            <input type="text" id="business_name" name="business_name" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
        </div>

        <div style="margin-bottom: 15px;">
            <label for="our_reference_code" style="display: block; margin-bottom: 5px; font-weight: bold;">Reference Code</label>
            <input type="text" id="our_reference_code" name="our_reference_code" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
        </div>

        <div style="margin-bottom: 15px;">
            <label for="business_number" style="display: block; margin-bottom: 5px; font-weight: bold;">Business Number</label>
            <input type="text" id="business_number" name="business_number" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
        </div>

        <div style="margin-bottom: 15px;">
            <label for="business_address" style="display: block; margin-bottom: 5px; font-weight: bold;">Business Address</label>
            <textarea id="business_address" name="business_address" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; min-height: 80px;"></textarea>
        </div>

        <div style="margin-bottom: 15px;">
            <label for="tax_exemption_number" style="display: block; margin-bottom: 5px; font-weight: bold;">Tax Exemption Number</label>
            <input type="text" id="tax_exemption_number" name="tax_exemption_number" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
        </div>

        <div style="margin-bottom: 15px;">
            <label for="tax_cloud" style="display: block; margin-bottom: 5px; font-weight: bold;">Tax Cloud</label>
            <input type="text" id="tax_cloud" name="tax_cloud" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
        </div>
    </fieldset>

    <button type="submit" style="background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">Add Contact</button>
    <a href="{% url 'contacts:contact_list' %}" style="background-color: #6c757d; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px;">Cancel</a>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get all form inputs
    const inputs = document.querySelectorAll('input, textarea');
    const form = document.querySelector('form');
    const phoneFields = document.querySelectorAll('.phone-field');

    // Add event listeners for paste events
    inputs.forEach(function(input) {
        input.addEventListener('paste', function(e) {
            // Small delay to ensure pasted content is processed
            setTimeout(function() {
                // Trigger change and input events to ensure validation
                input.dispatchEvent(new Event('input', { bubbles: true }));
                input.dispatchEvent(new Event('change', { bubbles: true }));
            }, 10);
        });

        // Also handle input events for any dynamic validation
        input.addEventListener('input', function() {
            // Trigger validation check
            if (input.checkValidity) {
                input.checkValidity();
            }
        });
    });

    // Validate at least one phone number on form submit
    form.addEventListener('submit', function(e) {
        let hasPhone = false;
        phoneFields.forEach(function(field) {
            if (field.value.trim()) {
                hasPhone = true;
            }
        });

        if (!hasPhone) {
            e.preventDefault();
            alert('At least one phone number (work, mobile, or home) is required.');
            return false;
        }
    });
});
</script>
{% endblock %}